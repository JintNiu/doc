## 聚合

Aggregate

为一组具有整体部分关系的对象维护不变规则。
聚合是若干个具有整体部分关系的领域对象的组合。
需要维护有强一致的业务规则。

### 特征：

1. 具有整体与部分的关系。
2. 具有不变规则，而且这种不变规则在并发的时候可能被破坏。

### 画法：

![](https://static001.geekbang.org/resource/image/13/e2/13a017fbf72295ac8c771a16fe4de6e2.jpg?wh=3231x2314)

1. 聚合根 `<<aggregate root>>` :

衍型 stereotype

在一个聚合里，像员工这样代表整体的实体就是聚合根。
一个聚合只有一个聚合根。

2. 整体部分关系：空心棱形:

有菱形的一端是代表“整体”的对象，另一端是代表“部分”的对象。

3. 一个包把这个聚合中的类包起来，从而可以一眼看出这个聚合的边界。

聚合包的名字和聚合根的名字是一样的。

4. 派生关联

derived association

表示方法：“/ 当前客户经理”

由其他实体推导出来的。
在 UML 中，凡是前面有斜杠的，就表示是派生出来的内容。

5. 聚合根要有全局的唯一标识
6. 表示部分的实体只能属于一个聚合，并且不能再变成其他聚合的一部分；
7. 聚合根被删除的话，整个聚合的实体都要被删除；
8. 聚合外部对象对非聚合根对象只能读，不能写，必须通过聚合根才能对非根对象进行访问
   1. 用包级私权限封装构造器和方法
   2. 返回不可变列表
   3. 用聚合根创建和访问非根对象等
